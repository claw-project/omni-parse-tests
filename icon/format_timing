#!/bin/bash

#
# This scripts helps to format the timing output generated by the full ICON
# parse test.
#

if [ ! -f LICENSE ] ; then
  echo "The script has to be executed from the root directory ./icon/format_timing"
  exit 1
fi

timing_file="build/icon_timing.log"
timing_file_tmp1="build/icon_timing_format1.log"
timing_file_tmp2="build/icon_timing_format2.log"
timing_file_formatted="build/icon_timing.out"

if [ ! -f LICENSE ] ; then
  echo "Timing file ${timing_file} is not present!"
  exit 1
fi

sed  '/^\s*$/d' ${timing_file} | sed 'N;N;N; s/\n/,/g' | sed 's/real//g' \
  | sed 's/user//g' | sed 's/sys//g' > ${timing_file_tmp1}

sed  '/^\s*$/d' ${timing_file} | sed 'N;N;N; s/\n/,/g' | sed 's/real//g' \
  | sed 's/user//g' | sed 's/sys//g' | awk -F, '{ print $2 }' | sed 's/m/:/g' \
  | sed 's/s//g' | sed s/:/*60+/g | bc > ${timing_file_tmp2}

paste -d , ${timing_file_tmp1} ${timing_file_tmp2} > ${timing_file_formatted}

echo "Formatted file located here: ${timing_file_formatted}"
exit 0
